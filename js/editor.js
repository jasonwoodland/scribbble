var updateTimeout, url;

$(window).ready(function() {
	options = {
		theme: 'base16-dark',
		lineNumbers: true,
		styleActiveLine: true,
		matchBrackets: true,
		indentWithTabs: true,
		indentUnit: 4,
		smartIndent: false,
		lineWrapping: true
	};
	htmlOptions = $.extend(true, {}, options);
	cssOptions = $.extend(true, {}, options);
	jsOptions = $.extend(true, {}, options);

	htmlOptions.htmlMode = true;
	htmlOptions.mode = 'xml';
	cssOptions.mode = 'css';
	jsOptions.mode = 'javascript';

	htmlPane = CodeMirror($('#html-pane')[0], htmlOptions);
	cssPane = CodeMirror($('#css-pane')[0], cssOptions);
	jsPane = CodeMirror($('#js-pane')[0], jsOptions);

	if(window.id) {
		htmlPane.setValue(atob(window.html));
		cssPane.setValue(atob(window.css));
		jsPane.setValue(atob(window.js));
	}


	$('#html-pane, #css-pane, #js-pane').bind('input propertychange cursorActivity keyup', function() {
		clearTimeout(updateTimeout);
		updateTimeout = setTimeout(function(){updateSandbox()}, 500);
	}).on('keydown', function(e) {
		key = e.keyCode || e.charCode;
		if(key == 8 || key == 46) $(this).trigger('input');
	});
	   
	function updateSandbox() {
		page = '<!DOCTYPE html><html><head>';
		page += '<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>';
		page += '<style>' + cssPane.getValue() + '</style>';
		page += '</head><body bgcolor="white">';
		page += htmlPane.getValue();
		page += '<script>' + jsPane.getValue() + '"</script>';
		page += '</body></html>';
		blob = new Blob([page], {type: 'text/html'});
		url = URL.createObjectURL(blob);
		$('#sandbox').css({
			opacity: 0
		}).prop('src', url);
	}

	updateSandbox();

	$('#sandbox').load(function() {
		$('#sandbox').css({
			opacity: 1
		});
		$('#sandbox-buffer').prop('src', url); 
	});

	$('.ion-gear-a').click(function() {
		htmlPane.setValue(atob('PHNjcmlwdCBzcmM9Imh0dHA6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMvcHJlZml4ZnJlZS8xLjAuNy9wcmVmaXhmcmVlLm1pbi5qcyI+PC9zY3JpcHQ+DQo8ZGl2IGlkPSJ3cmFwcGVyIj4NCiAgPGRpdiBpZD0iaXBob25lIj4NCiAgICA8ZGl2IGlkPSJzaWRlIj48L2Rpdj4NCiAgICA8ZGl2IGlkPSJsaW5lcyI+DQogICAgICA8ZGl2Pg0KICAgICAgICA8ZGl2Pg0KICAgICAgICAgIDxkaXY+PC9kaXY+DQogICAgICAgIDwvZGl2Pg0KICAgICAgPC9kaXY+DQogICAgICA8ZGl2Pg0KICAgICAgICA8ZGl2Pg0KICAgICAgICAgIDxkaXY+PC9kaXY+DQogICAgICAgIDwvZGl2Pg0KICAgICAgPC9kaXY+DQogICAgPC9kaXY+DQogICAgPGRpdiBpZD0idG9nZ2xlciI+DQogICAgICA8ZGl2PjwvZGl2Pg0KICAgIDwvZGl2Pg0KICAgIDxkaXYgaWQ9ImF1eCI+PC9kaXY+DQogICAgPGRpdiBpZD0ibGlnaHRuaW5nIj48L2Rpdj4NCiAgICA8ZGl2IGlkPSJib3R0b20tc3BlYWtlciI+DQogICAgICA8ZGl2PjwvZGl2Pg0KICAgICAgPGRpdj48L2Rpdj4NCiAgICAgIDxkaXY+PC9kaXY+DQogICAgICA8ZGl2PjwvZGl2Pg0KICAgICAgPGRpdj48L2Rpdj4NCiAgICAgIDxkaXY+PC9kaXY+DQogICAgICA8ZGl2PjwvZGl2Pg0KICAgIDwvZGl2Pg0KICAgIDxkaXYgaWQ9InNrcmV3cyI+DQogICAgICA8ZGl2PjwvZGl2Pg0KICAgICAgPGRpdj48L2Rpdj4NCiAgICA8L2Rpdj4NCiAgICA8ZGl2IGlkPSJ2b2x1bWUiPg0KICAgICAgPGRpdj48L2Rpdj4NCiAgICAgIDxkaXY+PC9kaXY+DQogICAgPC9kaXY+DQogICAgPGRpdiBpZD0iZnJvbnQiPg0KICAgICAgPGRpdiBpZD0iZnJvbnQtY292ZXIiPjwvZGl2Pg0KICAgICAgPGRpdiBpZD0iY2FtZXJhIj4NCiAgICAgICAgIDxkaXY+PC9kaXY+DQogICAgICA8L2Rpdj4NCiAgICAgIDxkaXYgaWQ9InNwZWFrZXIiPjwvZGl2Pg0KICAgICAgPGRpdiBpZD0ic2NyZWVuIj4NCiAgICAgICAgPGRpdiBpZD0icmVtaW5kZXIiPg0KICAgICAgICAgIDxkaXY+PC9kaXY+DQogICAgICAgICAgPGRpdj5NYWRlIGJ5IEBfZmJyejwvZGl2Pg0KICAgICAgICAgIDxkaXY+bm93PC9kaXY+DQogICAgICAgIDwvZGl2Pg0KICAgICAgICA8ZGl2IGlkPSJjaXJjbGUiPjwvZGl2Pg0KICAgICAgICA8ZGl2IGlkPSJ0aW1lIj4xMjo0MjwvZGl2Pg0KICAgICAgICA8ZGl2IGlkPSJkYXRlIj5TYXR1cmRheSwgSmFudWFyeSA0PC9kaXY+DQogICAgICAgIDxkaXYgaWQ9ImJvdHRvbSI+PC9kaXY+DQogICAgICAgIDxkaXYgaWQ9InRvcCI+PC9kaXY+DQogICAgICAgIDxkaXYgaWQ9InNsaWRlIj4NCiAgICAgICAgICA8ZGl2PjwvZGl2Pg0KICAgICAgICAgIHNsaWRlIHRvIHVubG9jaw0KICAgICAgICA8L2Rpdj4NCiAgICAgICAgPGRpdiBpZD0ic2lnbmFsIj4NCiAgICAgICAgICA8ZGl2PjwvZGl2Pg0KICAgICAgICAgIDxkaXY+PC9kaXY+DQogICAgICAgICAgPGRpdj48L2Rpdj4NCiAgICAgICAgICA8ZGl2PjwvZGl2Pg0KICAgICAgICAgIDxkaXY+PC9kaXY+DQogICAgICAgIDwvZGl2Pg0KICAgICAgICA8ZGl2IGlkPSJiYXR0ZXJ5Ij4NCiAgICAgICAgICA8ZGl2Pjg2JTwvZGl2Pg0KICAgICAgICAgIDxkaXY+DQogICAgICAgICAgICA8ZGl2PjwvZGl2Pg0KICAgICAgICAgICAgPGRpdj48L2Rpdj4NCiAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgPC9kaXY+DQogICAgICA8L2Rpdj4NCiAgICAgIDxkaXYgaWQ9ImhvbWUiPg0KICAgICAgICA8ZGl2PjwvZGl2Pg0KICAgICAgPC9kaXY+DQogICAgPC9kaXY+DQogICAgPGRpdiBpZD0ic2hhZG93Ij48L2Rpdj4NCiAgPC9kaXY+DQo8L2Rpdj4='));
		cssPane.setValue(atob('LyogTm8gaW1hZ2VzIGluIHRoaXMgcGVuIDpEICovDQoNCkBmb250LWZhY2Ugew0KICAgIGZvbnQtZmFtaWx5OiBIZWx2ZXRpY2E7DQogICAgc3JjOiB1cmwoaHR0cHM6Ly9zMy11cy13ZXN0LTIuYW1hem9uYXdzLmNvbS9zLmNkcG4uaW8vMTY0MjEwL0hlbHZldGljYU5ldWUtVWx0cmFMaWdodC5vdGYpIGZvcm1hdCgnVHJ1ZVR5cGUnKTsNCiAgZm9udC13ZWlnaHQ6IDMwMDsNCn0NCg0KYm9keSB7DQogIGZvbnQtZmFtaWx5OiAnSGVsdmV0aWNhJywgc2Fucy1zZXJpZjsNCiAgYmFja2dyb3VuZDogI2Y1ZjVmNTsNCiAgY29sb3I6ICMzMzM7DQogIGxldHRlci1zcGFjaW5nOiAxcHg7DQp9DQpodG1sLGJvZHkgew0KICBoZWlnaHQ6IDEwMCU7DQogIG1hcmdpbjogMDsNCiAgcGFkZGluZzogMDsNCiAgb3ZlcmZsb3c6IGhpZGRlbjsNCn0NCg0KI3dyYXBwZXIgew0KICBoZWlnaHQ6IDUyMHB4Ow0KICB3aWR0aDogODAwcHg7DQogIG1hcmdpbi1sZWZ0OiAtNDAwcHg7DQogIG1hcmdpbi10b3A6IC0yNjBweDsNCiAgcG9zaXRpb246IGFic29sdXRlOw0KICBwZXJzcGVjdGl2ZTogNjAwMHB4Ow0KICB0b3A6IDUwJTsNCiAgbGVmdDogNTAlOw0KfQ0KI2lwaG9uZSB7DQogIGhlaWdodDogNzYwcHg7DQogIHdpZHRoOiAzNzJweDsNCiAgYm9yZGVyLXJhZGl1czogNTBweDsNCiAgcG9zaXRpb246IGFic29sdXRlOw0KICBiYWNrZ3JvdW5kOiBub25lOyANCiAgYm94LXNoYWRvdzogbm9uZTsNCiAgbGVmdDogMjA2cHg7DQogIHRvcDogLTE0MHB4Ow0KICB0cmFuc2Zvcm06IHJvdGF0ZVgoNTRkZWcpIHJvdGF0ZVooLTQ2ZGVnKTsNCiAgdHJhbnNmb3JtLXN0eWxlOiBwcmVzZXJ2ZS0zZDsNCn0NCiNzaWRlIHsNCiBiYWNrZ3JvdW5kOiAjQ0REMEQ1Ow0KICB3aWR0aDogMzkzcHg7DQogIGhlaWdodDogNzgwcHg7DQogIGJvcmRlci10b3AtbGVmdC1yYWRpdXM6IDc3cHg7DQogIGJvcmRlci1ib3R0b20tbGVmdC1yYWRpdXM6IDQ5cHg7DQogIGJvcmRlci1ib3R0b20tcmlnaHQtcmFkaXVzOiA4NnB4Ow0KICBib3JkZXItdG9wLXJpZ2h0LXJhZGl1czogNzBweDsNCiAgcG9zaXRpb246IGFic29sdXRlOw0KICB0b3A6IDVweDsNCiAgbGVmdDogLTI2cHg7DQogIGJveC1zaGFkb3c6IGluc2V0ICMzRDNFNDIgMCAwIDE1cHggOXB4Ow0KfQ0KI2Zyb250IHsNCiAgd2lkdGg6IDM2MnB4Ow0KICBoZWlnaHQ6IDc1MHB4Ow0KICBib3JkZXItcmFkaXVzOiA0OXB4Ow0KICBwb3NpdGlvbjogYWJzb2x1dGU7DQogIGJhY2tncm91bmQtaW1hZ2U6IC13ZWJraXQtbGluZWFyLWdyYWRpZW50KC0yN2RlZywjNDQ0LCMwMDAgMTAlLCAjMDAwIDQyJSwgIzMzMywgIzAwMCA1NyUsICMwMDAgOTElLCAjNDQ0KTsNCiAgbGVmdDogNXB4Ow0KICB0b3A6IDVweDsNCiAgYm94LXNoYWRvdzogaW5zZXQgIzAwMCAwIDAgMCA0cHgsICM1NTUgMHB4IDAgM3B4IDBweCwgIzIyMiAtM3B4IDJweCwgIzAwMCAtNXB4IDVweCwgI0UwRTBFMCAtN3B4IDZweCAxcHgsICM2RDZENkQgLTdweCA2cHggOXB4Ow0KICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVaKDFweCk7DQp9DQojZnJvbnQtY292ZXIgew0KICB3aWR0aDogMzQ0cHg7DQogIGhlaWdodDogNzM0cHg7DQogIGJhY2tncm91bmQ6ICMwMDA7DQogIGJvcmRlci1yYWRpdXM6IDM5cHg7DQogIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgdG9wOiA4cHg7DQogIGxlZnQ6IDlweDsNCn0NCg0KI2hvbWUgew0KICBwb3NpdGlvbjogYWJzb2x1dGU7DQogIHdpZHRoOiA1MnB4Ow0KICBoZWlnaHQ6IDUycHg7DQogIGJvcmRlci1yYWRpdXM6IDUwJTsNCiAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDMyZGVnLCM2NjYsIzAwMCwjNjY2KTsNCiAgdG9wOiA2ODRweDsNCiAgbGVmdDogMTYwcHg7DQp9DQojaG9tZSBkaXYgew0KICBiYWNrZ3JvdW5kOiAjMDAwOw0KICBib3JkZXItcmFkaXVzOiA1MCU7DQogIHdpZHRoOiA0NnB4Ow0KICBoZWlnaHQ6IDQ2cHg7DQogIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgbGVmdDogM3B4Ow0KICB0b3A6IDNweDsNCn0NCg0KI2NhbWVyYSB7DQogIHdpZHRoOiAxMXB4Ow0KICBoZWlnaHQ6IDExcHg7DQogIGJhY2tncm91bmQ6ICMwMDA7DQogIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgdG9wOiAzNXB4Ow0KICBsZWZ0OiAxMjRweDsNCiAgYm9yZGVyLXJhZGl1czogNTAlOw0KICBib3gtc2hhZG93OiBpbnNldCAjNjY2IC01cHggMnB4IDlweCAtMnB4Ow0KfQ0KI2NhbWVyYSBkaXYgew0KICB3aWR0aDogNnB4Ow0KICBoZWlnaHQ6IDZweDsNCiAgYmFja2dyb3VuZDogcmFkaWFsLWdyYWRpZW50KCNFMUU0RjUsIzBEMkI2OSAzMyUpOw0KICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiAtMXB4IC0xcHg7DQogIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgdG9wOiAzcHg7DQogIGxlZnQ6IDNweDsNCiAgYm9yZGVyLXJhZGl1czogNTAlOw0KfQ0KDQojc3BlYWtlciB7DQogIHdpZHRoOiA1MHB4Ow0KICBoZWlnaHQ6IDRweDsNCiAgYm9yZGVyLXJhZGl1czogMnB4Ow0KICBiYWNrZ3JvdW5kOiAjNTU1Ow0KICBwb3NpdGlvbjogYWJzb2x1dGU7DQogIHRvcDogMzlweDsNCiAgbGVmdDogMTU2cHg7DQogIGJveC1zaGFkb3c6IGluc2V0ICMyMjIgMCAwcHggNHB4Ow0KfQ0KDQojdm9sdW1lIHsNCiAgaGVpZ2h0OiAxMjhweDsNCiAgd2lkdGg6IDExcHg7DQogIGJvcmRlci1yYWRpdXM6IDEwcHg7DQogIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgYmFja2dyb3VuZDogI0Y5RjlGQTsNCiAgdG9wOiAxNzFweDsNCiAgbGVmdDogLTIwcHg7DQogIHRyYW5zZm9ybTogcm90YXRlWSg5NWRlZyk7DQogIHRyYW5zZm9ybS1zdHlsZTogcHJlc2VydmUtM2Q7DQogIGJveC1zaGFkb3c6IGluc2V0ICMyOTJBMkYgNHB4IDAgOHB4IDFweCwgI0Q1RDVENSAtMXB4IDBweCAycHg7DQp9DQojdm9sdW1lIGRpdiB7DQogIHdpZHRoOiA4cHg7DQogIGhlaWdodDogNTVweDsNCiAgYmFja2dyb3VuZDogI0JCQkNDMDsNCiAgYm9yZGVyLXJhZGl1czogMTBweDsNCiAgcG9zaXRpb246IGFic29sdXRlOw0KICBib3gtc2hhZG93OiAjZWVlIC0xcHggMXB4LCAjNzc3IC0xcHggM3B4LCAgIzUwNTA1NyAtM3B4IDNweCwgaW5zZXQgIzkwOTE5NyAtM3B4IDAgM3B4Ow0KfQ0KDQojdm9sdW1lIGRpdjpmaXJzdC1jaGlsZCB7DQogIHRvcDogMnB4Ow0KICBsZWZ0OiA0cHg7DQp9DQojdm9sdW1lIGRpdjpsYXN0LWNoaWxkIHsNCiAgdG9wOiA2OXB4Ow0KICBsZWZ0OiA0cHg7DQp9DQoNCiN0b2dnbGVyIHsNCiAgaGVpZ2h0OiAzNHB4Ow0KICB3aWR0aDogOHB4Ow0KICBib3JkZXItcmFkaXVzOiAxMHB4Ow0KICBwb3NpdGlvbjogYWJzb2x1dGU7DQogIGJhY2tncm91bmQ6ICMyQjJDMzE7DQogIHRvcDogMTA1cHg7DQogIGxlZnQ6IC0yMHB4Ow0KICB0cmFuc2Zvcm06IHJvdGF0ZVkoOTVkZWcpOw0KICB0cmFuc2Zvcm0tc3R5bGU6IHByZXNlcnZlLTNkOw0KICBib3gtc2hhZG93OiBpbnNldCAjMjkyQTJGIDRweCAwIDhweCAxcHgsICNENUQ1RDUgLTFweCAwcHggMnB4Ow0KfQ0KI3RvZ2dsZXIgZGl2IHsNCiAgd2lkdGg6IDRweDsNCiAgaGVpZ2h0OiAzMXB4Ow0KICBiYWNrZ3JvdW5kOiAjQkJCQ0MwOw0KICBib3JkZXItcmFkaXVzOiAxMHB4Ow0KICBwb3NpdGlvbjogYWJzb2x1dGU7DQogIGJveC1zaGFkb3c6ICNlZWUgLTFweCAxcHgsICM3NzcgLTJweCAzcHgsICM1MDUwNTcgLTNweCAzcHgsIGluc2V0ICM5MDkxOTcgLTNweCAwIDNweDsNCiAgdG9wOiAtMXB4Ow0KICBsZWZ0OiAzcHg7DQp9DQoNCiNhdXggew0KICB3aWR0aDogMTlweDsNCiAgaGVpZ2h0OiAxOXB4Ow0KICBiYWNrZ3JvdW5kOiAjM0IzQjNCOw0KICBib3JkZXItcmFkaXVzOiA1MCU7DQogIHRyYW5zZm9ybTogcm90YXRlWCg5MGRlZykgdHJhbnNsYXRlWigxcHgpOw0KICB0cmFuc2Zvcm0tc3R5bGU6IHByZXNlcnZlLTNkOw0KICBwb3NpdGlvbjogYWJzb2x1dGU7DQogIHRvcDogNzY2cHg7DQogIGxlZnQ6IDQ1cHg7DQogIGJveC1zaGFkb3c6IGluc2V0ICMwMDAgNnB4IC0zcHggMTBweCAxcHgsICNDN0M3QzcgMXB4IDBweCAxcHg7DQp9DQoNCiNsaWdodG5pbmcgew0KICB3aWR0aDogNDhweDsNCiAgaGVpZ2h0OiAxMnB4Ow0KICBib3JkZXItcmFkaXVzOiAxMHB4Ow0KICBiYWNrZ3JvdW5kOiAjM0YzRjNGOw0KICB0cmFuc2Zvcm06IHJvdGF0ZVgoOTBkZWcpIHRyYW5zbGF0ZTNkKDBweCwxcHgsMHB4KTsNCiAgdG9wOiA3NzFweDsNCiAgcG9zaXRpb246IGFic29sdXRlOw0KICBsZWZ0OiAxMzlweDsNCiAgYm94LXNoYWRvdzogaW5zZXQgIzhFOEY5NCAtMXB4IDFweCAwcHggMnB4LCAjNTE1MjU4IDBweCAwcHggMCAxcHgsIGluc2V0ICMwMDAgMCAtM3B4IDEwcHgsICNEQURBREEgMXB4IDAgMCAxcHg7DQp9DQoNCiNib3R0b20tc3BlYWtlciB7DQogIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgdHJhbnNmb3JtOiByb3RhdGVYKDkwZGVnKTsNCiAgdG9wOiA3ODFweDsNCiAgbGVmdDogNzBweDsNCn0NCiNib3R0b20tc3BlYWtlciBkaXYgew0KICB3aWR0aDogOHB4Ow0KICBoZWlnaHQ6IDhweDsNCiAgYm9yZGVyLXJhZGl1czogNTAlOw0KICBiYWNrZ3JvdW5kOiAjNkM2RDcyOw0KICBwb3NpdGlvbjogYWJzb2x1dGU7DQogIGJveC1zaGFkb3c6IGluc2V0ICMwMDAgMXB4IC0xcHggNHB4IDFweCwgI0RBREFEQSAxcHggMHB4Ow0KfQ0KI2JvdHRvbS1zcGVha2VyIGRpdjpudGgtY2hpbGQoMikgeyBsZWZ0OiAxNTBweDsgfQ0KI2JvdHRvbS1zcGVha2VyIGRpdjpudGgtY2hpbGQoMykgeyBsZWZ0OiAxNjJweDsgfQ0KI2JvdHRvbS1zcGVha2VyIGRpdjpudGgtY2hpbGQoNCkgeyBsZWZ0OiAxNzRweDsgfQ0KI2JvdHRvbS1zcGVha2VyIGRpdjpudGgtY2hpbGQoNSkgeyBsZWZ0OiAxODZweDsgfQ0KI2JvdHRvbS1zcGVha2VyIGRpdjpudGgtY2hpbGQoNikgeyBsZWZ0OiAxOThweDsgfQ0KI2JvdHRvbS1zcGVha2VyIGRpdjpudGgtY2hpbGQoNykgeyBsZWZ0OiAyMTBweDsgfQ0KDQojc2tyZXdzIHsNCiAgcG9zaXRpb246IGFic29sdXRlOw0KICB0b3A6IDc4MHB4Ow0KICBsZWZ0OiAxMjBweDsNCiAgdHJhbnNmb3JtOiByb3RhdGVYKDkwZGVnKTsNCn0NCiNza3Jld3MgZGl2IHsNCiAgcG9zaXRpb246IGFic29sdXRlOw0KICB3aWR0aDogOHB4Ow0KICBoZWlnaHQ6IDhweDsNCiAgYmFja2dyb3VuZDogcmdiKDk1LCA5MiwgOTIpOw0KICBib3JkZXItcmFkaXVzOiA1MCU7DQogIHRvcDogMDsNCiAgei1pbmRleDogNDsNCiAgYm94LXNoYWRvdzogaW5zZXQgIzk5OUFBMCAgMCAwIDBweCAycHgsICM0NDQgMXB4IDBweDsNCn0NCg0KI3NrcmV3cyBkaXY6bGFzdC1jaGlsZCB7DQogIGxlZnQ6IDcwcHg7DQp9DQoNCiNsaW5lcyB7DQogIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgdG9wOiA4MnB4Ow0KICBsZWZ0OiAtMzJweDsNCn0NCiNsaW5lcyA+IGRpdjpsYXN0LWNoaWxkIHsNCiAgdG9wOiA2MzRweDsNCn0NCg0KI2xpbmVzIGRpdiB7DQogIHdpZHRoOiA3cHg7DQogIGhlaWdodDogMTFweDsNCiAgcG9zaXRpb246IGFic29sdXRlOw0KICB0cmFuc2Zvcm0tc3R5bGU6IHByZXNlcnZlLTNkOw0KICB0cmFuc2Zvcm0tb3JpZ2luOiAxMDAlIDEwMCU7DQp9DQoNCiNsaW5lcyA+IGRpdiB7DQogIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudChyaWdodCwjMzkzQTNDLCM1QTU5NUUpOw0KICB0cmFuc2Zvcm06IHJvdGF0ZVkoOTBkZWcpOw0KfQ0KI2xpbmVzID4gZGl2ID4gZGl2IHsNCiAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KHJpZ2h0LCM1QTU5NUUsIzg3ODY4QSk7DQogIHRyYW5zZm9ybTogcm90YXRlWSgxN2RlZyk7DQogIGxlZnQ6IC02cHg7DQp9DQojbGluZXMgPiBkaXYgPiBkaXYgPiBkaXYgew0KICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQocmlnaHQsIzg3ODY4QSwjQThBNkFEKTsNCiAgdHJhbnNmb3JtOiByb3RhdGVZKDE3ZGVnKTsNCiAgbGVmdDogLTZweDsNCn0NCg0KI3NoYWRvdyB7DQogIHdpZHRoOiAzNTBweDsNCiAgaGVpZ2h0OiA3NTVweDsNCiAgYmFja2dyb3VuZDogYmxhY2s7DQogIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgdG9wOiA1cHg7DQogIGxlZnQ6IDA7DQogIHRyYW5zZm9ybTogdHJhbnNsYXRlWigtMTdweCk7DQogIHRyYW5zZm9ybS1zdHlsZTogcHJlc2VydmUtM2Q7DQogIGJveC1zaGFkb3c6ICMwMDAgMCAwIDEwcHggMTVweDsNCiAgb3BhY2l0eTogMC40Ow0KICBib3JkZXItdG9wLWxlZnQtcmFkaXVzOiA3NnB4Ow0KICBib3JkZXItdG9wLXJpZ2h0LXJhZGl1czogMjAwcHg7DQogIGJvcmRlci1ib3R0b20tbGVmdC1yYWRpdXM6IDQwcHg7DQogIGJvcmRlci1ib3R0b20tcmlnaHQtcmFkaXVzOiA1NnB4Ow0KfQ0KDQojc2NyZWVuIHsNCiAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KCNBMUU1RTUsIzE5ODdBQSk7DQogIHdpZHRoOiAzMzZweDsNCiAgaGVpZ2h0OiA1ODlweDsNCiAgcG9zaXRpb246IGFic29sdXRlOw0KICB0b3A6IDgwcHg7DQogIGxlZnQ6IDEzcHg7DQogIGZvbnQtd2VpZ2h0OiAzMDA7DQogIGNvbG9yOiAjZmZmOw0KICBiYWNrZ3JvdW5kLXNpemU6IDIwMCUgMTAwJTsNCiAgb3ZlcmZsb3c6IGhpZGRlbjsNCn0NCg0KI3RpbWUgew0KICBmb250LXNpemU6IDg2cHg7DQogIGxlZnQ6IDU3cHg7DQogIHRvcDogMzdweDsNCiAgcG9zaXRpb246IGFic29sdXRlOw0KfQ0KI2RhdGUgew0KICBmb250LXNpemU6IDIwcHg7DQogIGxlZnQ6IDg1cHg7DQogIHRvcDogMTMwcHg7DQogIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCn0NCg0KI2JvdHRvbSB7DQogIHdpZHRoOiAzN3B4Ow0KICBoZWlnaHQ6IDdweDsNCiAgYm9yZGVyLXJhZGl1czogNXB4Ow0KICBiYWNrZ3JvdW5kOiAjMkFCMURCOw0KICBwb3NpdGlvbjogYWJzb2x1dGU7DQogIHRvcDogNTczcHg7DQogIGxlZnQ6IDE0OXB4Ow0KfQ0KI3RvcCB7DQogIHdpZHRoOiAzN3B4Ow0KICBoZWlnaHQ6IDdweDsNCiAgYm9yZGVyLXJhZGl1czogNXB4Ow0KICBiYWNrZ3JvdW5kOiAjRDdGRkZGOw0KICBwb3NpdGlvbjogYWJzb2x1dGU7DQogIHRvcDogMTBweDsNCiAgbGVmdDogMTQ5cHg7DQp9DQojc2xpZGUgew0KICBwb3NpdGlvbjogYWJzb2x1dGU7DQogIHRvcDogNDg5cHg7DQogIGxlZnQ6IDg4cHg7DQogIGZvbnQtc2l6ZTogMjhweDsNCiAgY29sb3I6ICMyQUIxREI7DQogIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudChsZWZ0LCMyRUM0RjMgMzAlLCNmZmYsIzJFQzRGMyA3MCUpOw0KICAtd2Via2l0LWJhY2tncm91bmQtY2xpcDogdGV4dDsNCiAgLXdlYmtpdC10ZXh0LWZpbGwtY29sb3I6IHRyYW5zcGFyZW50Ow0KICBiYWNrZ3JvdW5kLXNpemU6IDM1MHB4Ow0KICBhbmltYXRpb246IHNsaWRlIDVzIGxpbmVhciBpbmZpbml0ZTsNCn0NCg0KQGtleWZyYW1lcyBzbGlkZSB7DQogIDAlIHsgYmFja2dyb3VuZC1wb3NpdGlvbjogMTAwcHggMDsgfQ0KICA0MCUgeyBiYWNrZ3JvdW5kLXBvc2l0aW9uOiA0NDBweCAwOyB9DQogIDEwMCUgeyBiYWNrZ3JvdW5kLXBvc2l0aW9uOiA0NDBweCAwOyB9DQp9DQoNCiNzbGlkZSBkaXYgew0KICB0cmFuc2Zvcm06IHJvdGF0ZSgxMzVkZWcpOw0KICBib3JkZXItbGVmdDogMnB4IHNvbGlkICMyQUIxREI7DQogIGJvcmRlci10b3A6IDJweCBzb2xpZCAjMkFCMURCOw0KICB3aWR0aDogMTVweDsNCiAgaGVpZ2h0OiAxNXB4Ow0KICBwb3NpdGlvbjogYWJzb2x1dGU7DQogIGxlZnQ6IC0yOXB4Ow0KICB0b3A6IDEwcHg7DQp9DQoNCiNzaWduYWwgew0KICBwb3NpdGlvbjogYWJzb2x1dGU7DQogIHRvcDogOXB4Ow0KICBsZWZ0OiA3cHg7DQp9DQojc2lnbmFsIGRpdiB7DQogIHdpZHRoOiA2cHg7DQogIGhlaWdodDogNnB4Ow0KICBib3JkZXItcmFkaXVzOiA1MCU7DQogIGJhY2tncm91bmQ6ICNmZmY7DQogIGJvcmRlcjogMXB4IHNvbGlkICNmZmY7DQogIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCn0NCiNzaWduYWwgZGl2Om50aC1jaGlsZCgyKSB7DQogIGxlZnQ6IDlweDsNCn0NCiNzaWduYWwgZGl2Om50aC1jaGlsZCgzKSB7DQogIGxlZnQ6IDE4cHg7DQp9DQojc2lnbmFsIGRpdjpudGgtY2hpbGQoNCkgew0KICBsZWZ0OiAyN3B4Ow0KfQ0KI3NpZ25hbCBkaXY6bnRoLWNoaWxkKDUpIHsNCiAgbGVmdDogMzZweDsNCiAgYmFja2dyb3VuZDogbm9uZTsNCn0NCg0KI2JhdHRlcnkgew0KICBwb3NpdGlvbjogYWJzb2x1dGU7DQogIHRvcDogM3B4Ow0KICBsZWZ0OiAyNzBweDsNCiAgZm9udC1zaXplOiAxM3B4Ow0KfQ0KI2JhdHRlcnkgPiBkaXY6bGFzdC1jaGlsZCB7DQogIHdpZHRoOiAyN3B4Ow0KICBoZWlnaHQ6IDlweDsNCiAgYm9yZGVyOiAxcHggc29saWQgI2ZmZjsNCiAgcG9zaXRpb246IGFic29sdXRlOw0KICB0b3A6IDRweDsNCiAgbGVmdDogMjdweDsNCiAgYm9yZGVyLXJhZGl1czogMnB4Ow0KfQ0KI2JhdHRlcnkgZGl2IGRpdjpmaXJzdC1jaGlsZCB7DQogIHdpZHRoOiAyMXB4Ow0KICBoZWlnaHQ6IDdweDsNCiAgYmFja2dyb3VuZDogI2ZmZjsNCiAgcG9zaXRpb246IGFic29sdXRlOw0KICB0b3A6IDFweDsNCiAgbGVmdDogMXB4Ow0KfQ0KI2JhdHRlcnkgZGl2IGRpdjpsYXN0LWNoaWxkIHsNCiAgd2lkdGg6IDFweDsNCiAgaGVpZ2h0OiA2cHg7DQogIGJhY2tncm91bmQ6ICNGRkY7DQogIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgbGVmdDogMjlweDsNCiAgdG9wOiAycHg7DQogIGJvcmRlci1yYWRpdXM6IDAgMXB4IDFweCAwOw0KfQ0KDQojZmFicml6aW8gew0KCWJvcmRlci10b3A6IDEwMHB4IHNvbGlkIGJsYWNrOyANCglib3JkZXItcmlnaHQ6IDYzcHggc29saWQgdHJhbnNwYXJlbnQ7DQoJd2lkdGg6IDA7DQoJdHJhbnNmb3JtOiBzY2FsZSguMzMpOw0KCXRyYW5zZm9ybS1vcmlnaW46IDAgMDsNCgltYXJnaW46IDIwcHg7DQoJb3BhY2l0eTouNjsNCiAgcG9zaXRpb246IGFic29sdXRlOw0KICBib3R0b206IC0xMzBweDsNCn0NCiNmYWJyaXppbzpiZWZvcmUgew0KCWJhY2tncm91bmQ6IGJsYWNrOw0KCXdpZHRoOiAyMHB4Ow0KCWhlaWdodDogMzBweDsNCgljb250ZW50OiAnJzsNCglkaXNwbGF5OiBibG9jazsNCgl0cmFuc2Zvcm06IHNrZXdYKC0zMmRlZyk7DQoJcG9zaXRpb246IHJlbGF0aXZlOw0KCXRvcDogLTY1cHg7DQoJbGVmdDogMjlweDsNCn0NCiNmYWJyaXppbzphZnRlciB7DQoJYmFja2dyb3VuZDogYmxhY2s7DQoJd2lkdGg6IDQwcHg7DQoJaGVpZ2h0OiAzNnB4Ow0KCWNvbnRlbnQ6ICcnOw0KCWRpc3BsYXk6IGJsb2NrOw0KCXRyYW5zZm9ybTogc2tld1goLTMyZGVnKTsNCglwb3NpdGlvbjogcmVsYXRpdmU7DQoJdG9wOiAtMTMwcHg7DQoJbGVmdDogNDlweDsNCn0NCg0KI2NpcmNsZSB7DQogIHdpZHRoOiA1MHB4Ow0KICBoZWlnaHQ6IDUwcHg7DQogIGJhY2tncm91bmQ6IG5vbmU7DQogIGJvcmRlci1yYWRpdXM6IDUwJTsNCiAgYm94LXNoYWRvdzogcmdiYSgyNTUsMjU1LDI1NSwwLjEpIDE2MHB4IDMzNXB4LHJnYmEoMjU1LDI1NSwyNTUsMC4xKSAxMjBweCAyNzVweCAwIDEycHgscmdiYSgyNTUsMjU1LDI1NSwwLjEpIDYwcHggMzU1cHggMCAyM3B4LHJnYmEoMjU1LDI1NSwyNTUsMC4xKSAyMzBweCA0NDVweCAwIC04cHgscmdiYSgyNTUsMjU1LDI1NSwwLjEpIDYwcHggMTI1cHgscmdiYSgyNTUsMjU1LDI1NSwwLjEpIDI2MHB4IDE0NXB4IDAgMTJweCxyZ2JhKDI1NSwyNTUsMjU1LDAuMSkgMzAwcHggMTQ1cHggMCAyM3B4LHJnYmEoMjU1LDI1NSwyNTUsMC4xKSAxMDBweCA4NXB4IDAgLThweCxyZ2JhKDI1NSwyNTUsMjU1LDAuMSkgNTBweCAxNTVweCxyZ2JhKDI1NSwyNTUsMjU1LDAuMSkgMTUwcHggMjczcHggMCAtMnB4LHJnYmEoMjU1LDI1NSwyNTUsMC4xKSA1MHB4IDU1NXB4IDAgMjNweCxyZ2JhKDI1NSwyNTUsMjU1LDAuMSkgMTgwcHggNXB4IDAgLThweDsNCiAgYW5pbWF0aW9uOiBjaXJjbGUgMzBzIGxpbmVhciBpbmZpbml0ZSBhbHRlcm5hdGU7DQp9DQoNCkBrZXlmcmFtZXMgY2lyY2xlIHsNCiAgMCV7DQogICAgYm94LXNoYWRvdzogcmdiYSgyNTUsMjU1LDI1NSwwLjEpIDE2MHB4IDMzNXB4LHJnYmEoMjU1LDI1NSwyNTUsMC4xKSAxMjBweCAyNzVweCAwIDEycHgscmdiYSgyNTUsMjU1LDI1NSwwLjEpIDYwcHggMzU1cHggMCAyM3B4LHJnYmEoMjU1LDI1NSwyNTUsMC4xKSAyMzBweCA0NDVweCAwIC04cHgscmdiYSgyNTUsMjU1LDI1NSwwLjEpIDYwcHggMTI1cHgscmdiYSgyNTUsMjU1LDI1NSwwLjEpIDI2MHB4IDE0NXB4IDAgMTJweCxyZ2JhKDI1NSwyNTUsMjU1LDAuMSkgMzAwcHggMTQ1cHggMCAyM3B4LHJnYmEoMjU1LDI1NSwyNTUsMC4xKSAxMDBweCA4NXB4IDAgLThweCxyZ2JhKDI1NSwyNTUsMjU1LDAuMSkgMzUwcHggNTU1cHgscmdiYSgyNTUsMjU1LDI1NSwwLjEpIDM1MHB4IDI3M3B4IDAgLTJweCxyZ2JhKDI1NSwyNTUsMjU1LDAuMSkgMTUwcHggMzU1cHggMCAyM3B4LHJnYmEoMjU1LDI1NSwyNTUsMC4xKSAxODBweCAyMDVweCAwIC04cHgscmdiYSgyNTUsMjU1LDI1NSwwLjEpIDBweCAwcHggMCAtOHB4LHJnYmEoMjU1LDI1NSwyNTUsMC4xKSAxMDBweCA1NTVweCAwIDEwcHg7DQogIH0NCiAgMTAwJXsNCiAgICBib3gtc2hhZG93OiByZ2JhKDI1NSwyNTUsMjU1LDAuMSkgNzBweCAxMHB4LHJnYmEoMjU1LDI1NSwyNTUsMC4xKSAzMDBweCAyMDVweCAwIDEycHgscmdiYSgyNTUsMjU1LDI1NSwwLjEpIDBweCAxNTVweCAwIDIzcHgscmdiYSgyNTUsMjU1LDI1NSwwLjEpIDMzMHB4IDQ1cHggMCAtOHB4LHJnYmEoMjU1LDI1NSwyNTUsMC4xKSA0NjBweCAzMjVweCxyZ2JhKDI1NSwyNTUsMjU1LDAuMSkgMHB4IDQ0NXB4IDAgMTJweCxyZ2JhKDI1NSwyNTUsMjU1LDAuMSkgMzAwcHggMTQ1cHggMCAyM3B4LHJnYmEoMjU1LDI1NSwyNTUsMC4xKSAxMDBweCA4NXB4IDAgLThweCxyZ2JhKDI1NSwyNTUsMjU1LDAuMSkgNTBweCAxNTVweCxyZ2JhKDI1NSwyNTUsMjU1LDAuMSkgMTUwcHggMjczcHggMCAtMnB4LHJnYmEoMjU1LDI1NSwyNTUsMC4xKSAwcHggNTU1cHggMCAyM3B4LHJnYmEoMjU1LDI1NSwyNTUsMC4xKSAxODBweCA1cHggMCAtOHB4LHJnYmEoMjU1LDI1NSwyNTUsMC4xKSAzMDBweCA1NTVweCAwIC04cHgscmdiYSgyNTUsMjU1LDI1NSwwLjEpIDM1MHB4IDM1NXB4IDAgMTBweDsNCiAgfQ0KfQ0KDQojcmVtaW5kZXIgew0KICBwb3NpdGlvbjogYWJzb2x1dGU7DQp0b3A6IDIzMHB4Ow0KbGVmdDogNDBweDsNCndpZHRoOiAyOTZweDsNCmhlaWdodDogNTBweDsNCmJvcmRlci10b3A6IDFweCBzb2xpZCAjODZFMkYwOw0KYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICM4NkUyRjA7DQpsaW5lLWhlaWdodDogNTBweDsNCmZvbnQtd2VpZ2h0OiA0MDA7DQogIG9wYWNpdHk6IDA7DQogIGFuaW1hdGlvbjogcmVtaW5kZXIgLjFzIGxpbmVhciBmb3J3YXJkcyAxNXM7DQp9DQojcmVtaW5kZXIgZGl2OmZpcnN0LWNoaWxkIHsNCiAgYmFja2dyb3VuZDogI2ZmZjsNCiAgd2lkdGg6IDE2cHg7DQogIGhlaWdodDogMTZweDsNCiAgYm9yZGVyLXJhZGl1czogM3B4Ow0KICBwb3NpdGlvbjogYWJzb2x1dGU7DQogIHRvcDogMThweDsNCn0NCiNyZW1pbmRlciBkaXY6bnRoLWNoaWxkKDIpIHsNCiAgcG9zaXRpb246IGFic29sdXRlOw0KICBsZWZ0OiAzMHB4Ow0KfQ0KI3JlbWluZGVyIGRpdjpsYXN0LWNoaWxkew0KICAgcG9zaXRpb246IGFic29sdXRlOw0KbGVmdDogMjUxcHg7DQpmb250LXNpemU6IDExcHg7DQogIGNvbG9yOiAjODZFMkYwOw0KfQ0KDQpAa2V5ZnJhbWVzIHJlbWluZGVyIHsNCiAgMTAwJSB7DQogICAgb3BhY2l0eTogMTsNCiAgfQ0KfSANCg0KDQojYXd3d2FyZHMgew0KICBwb3NpdGlvbjogYWJzb2x1dGU7DQogIGJvdHRvbTogMzBweDsNCiAgbGVmdDogNzBweDsNCn0NCiNhd3d3YXJkcyBhIHsNCiAgY29sb3I6ICM0NDQ7DQogIHRleHQtZGVjb3JhdGlvbjogbm9uZTsNCiAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICM4ODg7DQp9DQoNCiNjb29sb3JzIHsNCiAgcG9zaXRpb246IGFic29sdXRlOw0KICBib3R0b206IDMwcHg7DQogIHJpZ2h0OiAzMHB4Ow0KICBjb2xvcjogIzQ0NDsNCiAgdGV4dC1kZWNvcmF0aW9uOiBub25lOw0KICBib3JkZXItYm90dG9tOiAxcHggc29saWQgIzg4ODsNCiAgYW5pbWF0aW9uOiBjb29sb3JzIDFzIGluZmluaXRlOw0KICBvcGFjaXR5OiAxOw0KfQ0KQGtleWZyYW1lcyBjb29sb3JzIHsNCiAgNTAlIHsgcmlnaHQ6IDQwcHg7IH0NCn0='));
		$('#html-pane').trigger('input');
	});

	$('#save-scribe').click(function() {
		console.log('saving...');
		$.post('/api/scribe-save', {
			id: window.id,
			html: htmlPane.getValue(),
			css: cssPane.getValue(),
			js: jsPane.getValue()
		}, function(response) {
			window.id = response;
		});
	});

	$('#delete-scribe').click(function() {
		$.post('/api/scribe-delete', {
			id: window.id
		}, function() {
			window.location = '/' + window.username;
		});
	});

	$('#like-scribe:not(.active)').click(function() {
		$(this).addClass('active');
		likes = $('span.counter span');
		likes.html(parseInt(likes.html()) + 1);
		$.post('/api/scribe-like', {
			id: window.id
		}, function() {
		});
	});


	resizeSandbox();
}).resize(function() {
	resizeSandbox();
});

function resizeSandbox() {
	$('#sandbox, #sandbox-buffer').height($(window).height() * .5 - 50);
	$('#editor-layout .block .CodeMirror').height($(window).height() * .5 - 40);
}
